---
- name: 'Install pip package'
  package:
    name: python-pip
    state: present
  register: status
  until: status is succeeded
  become: True
  when: transport == 's3'

- name: Install boto module
  pip:
    name:
      - pip
      - botocore
      - boto
      - boto3
    state: present
    extra_args: --upgrade
  register: install_packages
  until: install_packages is success
  become: True
  when: transport == 's3'

- name: 'Fetch solr patch with {{ transport }} transport'
  include_tasks: '{{ transport_driver }}'
  with_first_found:
    - '../fetch/{{ transport }}.yml'
    - '../fetch/unknown-transport.yml'
  loop_control:
    loop_var: transport_driver

- name: Install contrib hybris components
  unarchive:
    src: '{{ solr_contrib_hybris_patch }}'
    dest: '{{ solr_dest_path }}'
    owner: '{{ solr_user }}'
    group: '{{ solr_group }}'
    mode: 0755
    creates: '{{ solr_dest_path }}/contrib/hybris'
    remote_src: True
  become: True
  notify:
    - restart Solr Linux

- name: Install data hybris components
  unarchive:
    src: '{{ solr_data_hybris_patch }}'
    dest: '{{ solr_home }}'
    owner: '{{ solr_user }}'
    group: '{{ solr_group }}'
    mode: 0755
    creates: '{{ solr_home }}/configsets/default'
    remote_src: True
  become: True
  notify:
    - restart Solr Linux

- name: Start service
  service:
    name: '{{ solr_service_name }}'
    state: started
    enabled: True
  become: True
  when:
    - solr_service_start
